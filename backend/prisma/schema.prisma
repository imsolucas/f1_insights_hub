// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Driver {
  id              String   @id @default(cuid())
  driverId        String   @unique @map("driver_id")
  code            String?
  forename        String
  surname         String
  dateOfBirth     DateTime? @map("date_of_birth")
  nationality     String
  url             String?
  permanentNumber Int?     @map("permanent_number")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  raceResults      RaceResult[]
  qualifyingResults QualifyingResult[]

  @@map("drivers")
  @@index([driverId])
}

model Constructor {
  id            String   @id @default(cuid())
  constructorId String   @unique @map("constructor_id")
  name          String
  nationality   String
  url           String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  raceResults      RaceResult[]
  qualifyingResults QualifyingResult[]

  @@map("constructors")
  @@index([constructorId])
}

model Circuit {
  id         String   @id @default(cuid())
  circuitId  String   @unique @map("circuit_id")
  name       String
  location   String
  country    String
  lat        Float?
  long       Float?
  alt        Int?
  url        String?
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  races Race[]

  @@map("circuits")
  @@index([circuitId])
}

model Season {
  id        String   @id @default(cuid())
  year      Int      @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("seasons")
  @@index([year])
}

model Race {
  id              String    @id @default(cuid())
  season          Int
  round           Int
  raceName        String    @map("race_name")
  circuitId       String    @map("circuit_id")
  date            DateTime
  time            String?
  url             String?
  sprintDate      DateTime? @map("sprint_date")
  sprintTime      String?  @map("sprint_time")
  qualifyingDate  DateTime? @map("qualifying_date")
  qualifyingTime  String?   @map("qualifying_time")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  circuit           Circuit           @relation(fields: [circuitId], references: [id])
  raceResults        RaceResult[]
  qualifyingResults  QualifyingResult[]

  @@map("races")
  @@index([season])
  @@index([circuitId])
  @@index([date])
  @@unique([season, round])
}

model RaceResult {
  id              String    @id @default(cuid())
  raceId          String    @map("race_id")
  driverId        String    @map("driver_id")
  constructorId   String    @map("constructor_id")
  position        Int?
  points          Float
  grid            Int?
  laps            Int?
  status          String
  time            String?
  milliseconds    Int?
  fastestLap      Int?       @map("fastest_lap")
  fastestLapTime  String?    @map("fastest_lap_time")
  fastestLapSpeed Float?     @map("fastest_lap_speed")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  race        Race        @relation(fields: [raceId], references: [id], onDelete: Cascade)
  driver      Driver      @relation(fields: [driverId], references: [id])
  constructor Constructor  @relation(fields: [constructorId], references: [id])

  @@map("race_results")
  @@index([raceId])
  @@index([driverId])
  @@index([constructorId])
  @@index([raceId, driverId])
}

model QualifyingResult {
  id            String   @id @default(cuid())
  raceId        String   @map("race_id")
  driverId       String   @map("driver_id")
  constructorId String   @map("constructor_id")
  position       Int
  q1             String?
  q2             String?
  q3             String?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  race        Race        @relation(fields: [raceId], references: [id], onDelete: Cascade)
  driver      Driver      @relation(fields: [driverId], references: [id])
  constructor Constructor @relation(fields: [constructorId], references: [id])

  @@map("qualifying_results")
  @@index([raceId])
  @@index([driverId])
  @@index([raceId, driverId])
}