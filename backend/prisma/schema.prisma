// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Driver {
  id                       String    @id @default(cuid())
  driverId                 String    @unique @map("driver_id")
  code                     String?
  forename                 String
  surname                  String
  dateOfBirth              DateTime? @map("date_of_birth")
  nationality              String
  url                      String?
  permanentNumber          Int?      @map("permanent_number")
  driverChampionships      Int       @default(0) @map("driver_championships")
  constructorChampionships Int       @default(0) @map("constructor_championships")
  currentTeam              String?   @map("current_team")
  isActive                 Boolean   @default(true) @map("is_active")
  createdAt                DateTime  @default(now()) @map("created_at")
  updatedAt                DateTime  @updatedAt @map("updated_at")

  raceResults         RaceResult[]
  qualifyingResults   QualifyingResult[]
  driverSeasonLineups DriverSeasonLineup[]

  @@index([driverId])
  @@map("drivers")
}

model Constructor {
  id            String   @id @default(cuid())
  constructorId String   @unique @map("constructor_id")
  name          String
  nationality   String
  url           String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  raceResults              RaceResult[]
  qualifyingResults        QualifyingResult[]
  constructorSeasonLineups ConstructorSeasonLineup[]

  @@index([constructorId])
  @@map("constructors")
}

model DriverSeasonLineup {
  id          String   @id @default(cuid())
  season      Int
  driverId    String   @map("driver_id")
  teamName    String   @map("team_name")
  driverNumber Int?    @map("driver_number")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  driver Driver @relation(fields: [driverId], references: [id])

  @@unique([season, driverId])
  @@index([season])
  @@index([driverId])
  @@map("driver_season_lineups")
}

model ConstructorSeasonLineup {
  id            String   @id @default(cuid())
  season        Int
  constructorId String   @map("constructor_id")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  constructor Constructor @relation(fields: [constructorId], references: [id])

  @@unique([season, constructorId])
  @@index([season])
  @@index([constructorId])
  @@map("constructor_season_lineups")
}

model Circuit {
  id        String   @id @default(cuid())
  circuitId String   @unique @map("circuit_id")
  name      String
  location  String
  country   String
  lat       Float?
  long      Float?
  alt       Int?
  url       String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  races Race[]

  @@index([circuitId])
  @@map("circuits")
}

model Season {
  id        String   @id @default(cuid())
  year      Int      @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([year])
  @@map("seasons")
}

model Race {
  id             String    @id @default(cuid())
  season         Int
  round          Int
  raceName       String    @map("race_name")
  circuitId      String    @map("circuit_id")
  date           DateTime
  time           String?
  url            String?
  sprintDate     DateTime? @map("sprint_date")
  sprintTime     String?   @map("sprint_time")
  qualifyingDate DateTime? @map("qualifying_date")
  qualifyingTime String?   @map("qualifying_time")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")

  circuit           Circuit            @relation(fields: [circuitId], references: [id])
  raceResults       RaceResult[]
  qualifyingResults QualifyingResult[]

  @@unique([season, round])
  @@index([season])
  @@index([circuitId])
  @@index([date])
  @@map("races")
}

model RaceResult {
  id              String   @id @default(cuid())
  raceId          String   @map("race_id")
  driverId        String   @map("driver_id")
  constructorId   String   @map("constructor_id")
  position        Int?
  points          Float
  grid            Int?
  laps            Int?
  status          String
  time            String?
  milliseconds    Int?
  fastestLap      Int?     @map("fastest_lap")
  fastestLapTime  String?  @map("fastest_lap_time")
  fastestLapSpeed Float?   @map("fastest_lap_speed")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  race        Race        @relation(fields: [raceId], references: [id], onDelete: Cascade)
  driver      Driver      @relation(fields: [driverId], references: [id])
  constructor Constructor @relation(fields: [constructorId], references: [id])

  @@index([raceId])
  @@index([driverId])
  @@index([constructorId])
  @@index([raceId, driverId])
  @@map("race_results")
}

model QualifyingResult {
  id            String   @id @default(cuid())
  raceId        String   @map("race_id")
  driverId      String   @map("driver_id")
  constructorId String   @map("constructor_id")
  position      Int
  q1            String?
  q2            String?
  q3            String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  race        Race        @relation(fields: [raceId], references: [id], onDelete: Cascade)
  driver      Driver      @relation(fields: [driverId], references: [id])
  constructor Constructor @relation(fields: [constructorId], references: [id])

  @@index([raceId])
  @@index([driverId])
  @@index([raceId, driverId])
  @@map("qualifying_results")
}
